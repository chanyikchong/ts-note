# 常见面试问题

<div class="interview-summary">
<strong>面试要点：</strong> 本节汇编了时间序列面试中常见问题及简明答案。主题涵盖基础知识（平稳性、ACF/PACF）、模型选择（ARIMA vs. ETS vs. ML）、实践挑战（季节性、缺失数据、预测策略）以及高级主题（状态空间、深度学习）。面试前可作为快速复习使用。
</div>

## 基础知识

### 问题1：什么是平稳性，为什么它重要？

**答案：** 平稳过程具有恒定均值、恒定方差，且自协方差仅取决于滞后（而非时间）。它重要的原因：
- 大多数经典模型（ARIMA、VAR）假设平稳性
- 非平稳序列具有不可预测的长期行为
- 统计检验和推断需要平稳性

**检验方法：** ADF（原假设：单位根），KPSS（原假设：平稳）。两者一起使用得到稳健结论。

**使其平稳：** 差分（随机趋势）、去趋势（确定性趋势）、对数变换（变化的方差）。

### 问题2：解释ACF和PACF的区别。

**答案：**
- **ACF：** $y_t$ 和 $y_{t-k}$ 之间的总相关性，包括通过中间滞后的间接效应
- **PACF：** 去除 $y_{t-1}, \ldots, y_{t-k+1}$ 效应后，$y_t$ 和 $y_{t-k}$ 之间的直接相关性

**用于识别：**
- ACF在滞后q处截断 → MA(q)
- PACF在滞后p处截断 → AR(p)
- 两者都拖尾 → ARMA

### 问题3：如何处理季节性？

**答案：** 多种方法：
1. **季节差分：** $(1-L^s)y_t$ 去除季节性单位根
2. **SARIMA：** 显式的季节性AR/MA项
3. **季节分解：** STL分离趋势、季节性、残差
4. **傅里叶项：** 季节频率的正弦/余弦特征
5. **虚拟变量：** 用于短季节周期

## 模型选择

### 问题4：什么时候选择ARIMA而不是指数平滑（ETS）？

**答案：**
- **ARIMA：** 当序列具有复杂的自相关结构、需要包含外部回归变量（ARIMAX）、AR/MA结构的可解释性重要时
- **ETS：** 当你想在30种变体中自动选择模型、当预测是主要目标、当你需要适当的状态空间框架来计算区间时

**实践中：** 两者通常给出相似的预测。使用你的场景中更容易实现和解释的那个。

### 问题5：如何在传统方法和机器学习之间选择？

**答案：**

| 因素 | 传统方法（ARIMA/ETS） | ML（RF、LSTM等） |
|--------|----------------------|---------------------|
| 数据量 | 小-中等 | 大 |
| 可解释性 | 高 | 低 |
| 不确定性 | 校准良好的区间 | 难以量化 |
| 多序列 | 分别建模 | 可以共享模式 |
| 复杂模式 | 有限 | 可以学习任何东西 |
| 计算成本 | 低 | 高 |

**经验法则：** 从传统基线开始。如果你有大量数据且传统方法表现不佳，才使用ML。

### 问题6：模型选择用什么信息准则？解释AIC vs BIC。

**答案：**
- **AIC = -2ln(L) + 2k：** 优化预测误差；大样本时可能过拟合
- **BIC = -2ln(L) + k·ln(n)：** 一致（选择真实模型）；更简约
- **AICc：** 小样本校正的AIC（当n/k < 40时使用）

**指导原则：** 预测用AICc，推断/解释用BIC。

## 实践挑战

### 问题7：如何处理时间序列中的缺失值？

**答案：**
1. **线性插值：** 用于零星缺失值
2. **前向/后向填充：** 当最后已知值合理时
3. **季节性填充：** 用前一周期相同时点填充
4. **基于模型：** 卡尔曼滤波或EM算法
5. **缺失指示变量：** 添加二元特征，让模型学习

**永远不要：** 删除行（破坏时间连续性）或全局使用均值填充。

### 问题8：什么是时间序列中的数据泄漏？如何防止？

**答案：** 训练或创建特征时使用了未来信息。

**常见来源：**
- 随机训练-测试分割（未来在训练集中）
- 滚动特征没有shift（包含当前值）
- 在全部数据上缩放（测试统计信息在训练中）
- 预测时不可用的外部特征

**预防：**
- 始终按时间分割
- 特征使用`.shift(1).rolling()`
- 仅在训练数据上拟合缩放器
- 验证生产中的特征可用性

### 问题9：解释多步预测策略。

**答案：**
1. **递归：** 使用1步模型，迭代（将预测反馈回去）
2. **直接：** 为每个时间范围训练单独的模型
3. **MIMO：** 单个模型输出所有时间范围

**权衡：**
- 递归：一个模型，但误差累积
- 直接：无误差累积，但需要h个模型
- MIMO：平衡，但需要仔细的架构

**对于ARIMA：** 递归是标准且最优的。
**对于ML：** 直接通常更好（避免复合误差）。

### 问题10：如何评估预测准确度？

**答案：**

**指标：**
- MAE：易于解释，对离群值稳健
- RMSE：更多惩罚大误差
- MAPE：百分比误差，但在零点未定义
- MASE：无尺度，与朴素预测比较（MASE < 1是好的）

**评估：**
- 使用滚动原点交叉验证
- 评估时间范围匹配业务需求
- 始终与基线比较（朴素、季节性朴素）
- 检查预测区间覆盖率

## 高级主题

### 问题11：什么是卡尔曼滤波器，什么时候使用？

**答案：** 线性高斯状态空间模型中最优状态估计的递归算法。

**用例：**
- 跟踪不可观测的成分（水平、趋势）
- 在线滤波（数据到达时更新）
- 缺失数据处理（自然框架）
- 时变参数

**联系：** ETS、ARIMA、结构时间序列都是状态空间模型；卡尔曼滤波器提供统一的估计。

### 问题12：解释格兰杰因果关系。它有什么局限性？

**答案：** 如果X的过去值能改善Y的预测（超过Y自身的过去），则X格兰杰因果于Y。

**局限性：**
- **不是真正的因果：** 共同原因导致的相关性给出虚假的格兰杰因果
- **需要平稳性：** 标准检验需要平稳数据
- **对滞后选择敏感：** 不同滞后结果不同
- **遗漏变量偏差：** 同时导致X和Y的Z被遗漏
- **忽略同期效应：** 只检验滞后关系

### 问题13：什么时候应该使用深度学习处理时间序列？

**答案：** 当以下条件满足时考虑深度学习：
- 大数据集（数千以上的观测值）
- 多个相关序列（可以共享表示）
- 复杂模式（非线性、交互效应）
- 长程依赖（注意力机制有帮助）

**避免深度学习当：**
- 小数据集（ARIMA通常获胜）
- 需要可解释性
- 简单模式（奥卡姆剃刀）
- 计算受限

**流行架构：** LSTM、TCN（时间CNN）、Transformer

### 问题14：如何检测和处理结构性断点？

**答案：**

**检测：**
- 目视检查
- Chow检验（在已知点检验断点）
- CUSUM（残差累积和）
- PELT算法（多个变点）

**处理：**
- 状态切换模型（马尔可夫切换）
- 回归中的结构性断点虚拟变量
- 仅在断点后的数据上训练
- 时变参数

### 问题15：什么是预测协调？

**答案：** 确保不同聚合级别的预测一致。

**示例：** 产品预测应该加起来等于品类预测，品类预测加起来等于总计。

**方法：**
- **自上而下：** 预测总计，分配
- **自下而上：** 预测个体，求和
- **最优协调：** 最优组合所有级别（MinT方法）

**为什么重要：** 不一致的预测会混淆计划（库存、预算）。

## 测验

<details class="quiz">
<summary><strong>问题1（概念题）：</strong> Box-Jenkins方法论的三个组成部分是什么？</summary>

<div class="answer">
<strong>答案：</strong> 识别、估计、诊断检验

1. **识别：** 使用ACF/PACF、平稳性检验确定(p, d, q)
2. **估计：** 使用MLE或条件最小二乘拟合模型
3. **诊断检验：** 验证残差是白噪声（Ljung-Box、ACF图）

如果诊断失败则迭代：返回识别阶段。

<div class="pitfall">
<strong>常见陷阱：</strong> 跳过诊断。AIC好的模型仍可能有自相关残差，表明模型设定错误。
</div>
</div>
</details>

<details class="quiz">
<summary><strong>问题2（概念题）：</strong> 解释时间序列预测中的偏差-方差权衡。</summary>

<div class="answer">
<strong>答案：</strong>
- **偏差：** 错误模型假设导致的系统性误差（欠拟合）
- **方差：** 对训练数据的敏感性（过拟合）

**在时间序列的背景下：**
- 简单模型（AR(1)）：可能漏掉模式（高偏差）但稳定（低方差）
- 复杂模型（ARIMA(5,1,5)）：捕获模式但不稳定（高方差）

**表现：**
- 高偏差：训练拟合差，测试表现相似
- 高方差：训练拟合好，测试表现差

**正则化：** AIC/BIC惩罚复杂度；交叉验证估计样本外误差。

<div class="pitfall">
<strong>常见陷阱：</strong> 只看训练误差。始终在保留集或通过交叉验证评估。
</div>
</div>
</details>

<details class="quiz">
<summary><strong>问题3（数学题）：</strong> ARIMA(0,1,1)的预测函数是什么？它与指数平滑有什么关系？</summary>

<div class="answer">
<strong>答案：</strong>
ARIMA(0,1,1)：$(1-L)y_t = (1+\theta L)\epsilon_t$

预测函数：
$$\hat{y}_{T+h|T} = y_T + \theta\hat{\epsilon}_T = y_T + \theta(y_T - \hat{y}_{T|T-1})$$

这等于简单指数平滑，其中 $\alpha = 1/(1+\theta)$：
$$\hat{y}_{T+h|T} = \alpha y_T + (1-\alpha)\hat{y}_{T|T-1}$$

**联系：** SES对于局部水平模型 / ARIMA(0,1,1)是最优的。

<div class="pitfall">
<strong>常见陷阱：</strong> 把ARIMA和ETS当作完全不同的东西。它们有深层联系；很多ETS模型有ARIMA等价形式。
</div>
</div>
</details>

<details class="quiz">
<summary><strong>问题4（数学题）：</strong> 在存在季节性的情况下如何检验单位根？</summary>

<div class="answer">
<strong>答案：</strong>
标准ADF检验非季节性单位根。对于季节性单位根：

1. **HEGY检验：** 检验季节和零频率处的单位根
2. **Canova-Hansen：** 检验季节频率处平稳的原假设
3. **OCSB检验：** 专门用于季节性单位根

**实践方法：**
1. 首先检验季节性单位根（OCSB/HEGY）
2. 如果存在，应用季节差分 $(1-L^s)$
3. 然后对季节差分后的序列检验常规单位根（ADF）
4. 如果需要则应用常规差分

<div class="pitfall">
<strong>常见陷阱：</strong> 直接对季节性数据使用ADF。ADF可能因为季节性而拒绝单位根，而不是因为序列平稳。
</div>
</div>
</details>

<details class="quiz">
<summary><strong>问题5（实践题）：</strong> 要求你预测零售商的日销售额。描述你的方法。</summary>

<div class="answer">
<strong>答案：</strong>

**1. 理解数据：**
- 历史长度、粒度
- 缺失值、离群值
- 外部因素（节假日、促销）

**2. 探索模式：**
- 绘制序列、分解
- 检查趋势、周度/年度季节性
- 检查ACF/PACF

**3. 基线模型：**
- 朴素（昨天的销售额）
- 季节性朴素（上周同一天）
- 移动平均

**4. 候选模型：**
- SARIMA（捕获ARMA + 季节性）
- ETS（自动模型选择）
- Prophet（处理节假日，易用）
- XGBoost配合滞后特征（如果有多序列）

**5. 评估：**
- 滚动原点交叉验证（最后8-12周）
- 指标：MAE、MAPE、MASE
- 与基线比较

**6. 生产考虑：**
- 需要的预测范围
- 更新频率
- 不确定性沟通
- 监控和重训练计划

<div class="pitfall">
<strong>常见陷阱：</strong> 直接跳到复杂模型。从简单开始（季节性朴素通常难以击败），只有在评估证明合理时才增加复杂度。
</div>
</div>
</details>

## 参考文献

1. Hyndman, R. J., & Athanasopoulos, G. (2021). *Forecasting: Principles and Practice*. OTexts.
2. Box, G. E. P., Jenkins, G. M., Reinsel, G. C., & Ljung, G. M. (2015). *Time Series Analysis*. Wiley.
3. Hamilton, J. D. (1994). *Time Series Analysis*. Princeton University Press.
4. Shumway, R. H., & Stoffer, D. S. (2017). *Time Series Analysis and Its Applications*. Springer.
